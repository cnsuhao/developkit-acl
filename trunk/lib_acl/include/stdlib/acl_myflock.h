#ifndef __ACL_MYFLOCK_H_INCLUDED__
#define __ACL_MYFLOCK_H_INCLUDED__

#ifdef  __cplusplus
extern "C" {
#endif

#include "acl_define.h"

/**
 * 对打开的文件句柄进行加锁
 * @param fd {ACL_FILE_HANDLE} 文件句柄
 * @param lock_style {int} 系统提供的API加锁类型（仅对UNIX有效）
 *  ACL_MYFLOCK_STYLE_FLOCK or ACL_MYFLOCK_STYLE_FCNTL
 * @param operation {int} 加锁操作方式, ACL_MYFLOCK_OP_XXX
 * @return {int} 0: 加锁成功; -1: 加锁失败
 */
ACL_API int acl_myflock(ACL_FILE_HANDLE fd, int lock_style, int operation);

/*
 * Lock styles.
 */
#define ACL_MYFLOCK_STYLE_FLOCK     1  /**< 调用 flock 函数加锁(unix) */
#define ACL_MYFLOCK_STYLE_FCNTL     2  /**< 调用 fcntl 函数加锁(unix) */

/*
 * Lock request types.
 */
#define ACL_MYFLOCK_OP_NONE         0  /**< 解锁 */
#define ACL_MYFLOCK_OP_SHARED       1  /**< 共享锁 */
#define ACL_MYFLOCK_OP_EXCLUSIVE    2  /**< 排它独享锁 */
#define ACL_MYFLOCK_OP_NOWAIT       4  /**< 无等待加锁, 可以与
                                          ACL_MYFLOCK_OP_SHARED,
                                          或 ACL_MYFLOCK_OP_EXCLUSIVE 相或 */

/**
 * 加锁方式的位集合
 */
#define ACL_MYFLOCK_OP_BITS \
	(ACL_MYFLOCK_OP_SHARED | ACL_MYFLOCK_OP_EXCLUSIVE | ACL_MYFLOCK_OP_NOWAIT)

#ifdef  __cplusplus
}
#endif

#endif

